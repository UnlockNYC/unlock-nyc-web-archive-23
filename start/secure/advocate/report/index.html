<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport"
        content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="/styles/site.css">
    <title>Advocate Login: Unlock NYC</title>
    <style>
        body {
            background-color: #23296a;
        }

        #form-page {
            background-color: White;
            padding: 5%;
            width: 85%;
            margin: auto;
            min-width: 500px;
            min-height: 100vh;
        }

        h2 {
            font-size: 18px;
        }

        select#clients {
            border: 1px solid black;
            padding: 10px 18px 10px 18px;
            border-radius: 10px;
            width: 50%;
        }

    </style>
    <script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <div id="form-page">
        <h1>
            UNLOCK <br> NYC <br>
        </h1>
        <h1>
            ADVOCATE REPORT FORM
        </h1>
        <h2 id="email"></h2>
        <h2 id="org"></h2>
        <form id="advocate-report" action="/.netlify/functions/submit-advocate" method="post">
            <select name="clients" id="clients">
            </select>
            <input type="submit">Submit Report</input>
        </form>
    </div>
    <script>
        $(document).ready(async function () {
            let userToken = JSON.parse(window.localStorage.getItem("gotrue.user")).token;
            let userInfo = JSON.parse(window.localStorage.getItem("gotrue.user"));
            console.log(userInfo);
            $("h2#email").html(userInfo.email);
            $("h2#org").html(userInfo.app_metadata.org)
            let response = await fetch('/.netlify/functions/read-advocate', {
                method: 'POST',
                body: JSON.stringify(userToken),
                headers: {
                    "Content-Type": "application/json"
                }
            });
            let data = await response.json();
            console.log(data)
            let clientList = data.clientList;
            for (i = 0; i < clientList.length; i++) {
                $('select#clients').append($('<option>', {value: `${clientList[i].id}`, text: `${clientList[i].name}`}));
            }

        });
    </script>
</body>

</html>
